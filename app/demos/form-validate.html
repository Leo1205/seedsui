<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>form-validate</title>
    <link rel="stylesheet" href="../scripts/lib/seedsui/seedsui.min.css">
    <style type="text/css">
    .app-error-active {
        background-color: #ffecec;
    }
    .icon-eye-fill.active{
        color: #18b2ed;
    }
    </style>
</head>

<body ontouchstart="">
    <header>
        <div class="titlebar">
            <a class="titlebar-button" href="javascript:back()"><i class="icon icon-arrowleft"></i></a>
            <h1 class="titlebar-title">表单验证</h1>
        </div>
    </header>
    <article>
    	<form id="ID-Form" method="post" style="padding:10px;">
            <div class="inputbox bordered" style="margin:8px 0;" data-input="clear">
                <input type="text" class="input-text" placeholder="用户名" name="NID-UserName" maxlength="16"/>
                <i class="icon icon-clear-fill color-placeholder hide"></i>
            </div>
            <div class="inputbox bordered" style="margin:8px 0;" data-input="reveal">
                <input type="password" class="input-text" placeholder="密码" name="NID-Pwd" maxlength="16"/>
                <i class="icon icon-eye-fill color-placeholder"></i>
                <div class="safelvl lvl0">
                    <div class="safelvl-progress"></div>
                	<ul>
                		<li>弱</li>
                		<li>中</li>
                		<li>强</li>
                	</ul>
                </div>
            </div>
            
            <div style="height:22px;"></div>

            <div class="inputbox bordered" style="margin:8px 0;" data-input="reveal">
                <input type="password" class="input-text" placeholder="确认" name="NID-RePwd" data-rule-field="密码" data-rule="required password compare:NID-RePwd minlength:6 maxlength:16"/>
                <i class="icon icon-eye-fill color-placeholder"></i>
            </div>

            <div class="inputbox bordered" style="margin:8px 0;">
                <input type="text" class="input-text" placeholder="手机号码" name="NID-Phone"/>
            </div>

            <div class="inputbox bordered" style="margin:8px 0;">
                <input type="text" class="input-text" placeholder="中文姓名" name="NID-Name"/>
            </div>

            <div class="inputbox bordered" style="margin:8px 0;">
                <input type="text" class="input-text" placeholder="邮箱" name="NID-Mail"/>
            </div>

            <div class="inputbox bordered" style="margin:8px 0;">
                <input type="number" class="input-text" placeholder="年龄" name="NID-Age"/>
            </div>

            <input type="submit" class="button submit block SID-BtnSubmit" style="width: 100%;" value="注册"/>
    	</form>
    </article>
    
    <script src="../scripts/lib/seedsui/seedsui.min.js"></script>
    <!--Exmobi能力-->
    <!--<script src="../scripts/lib/exmobi/exmobi.js"></script>-->
    <script>
        var view={
            /*=========================
              Model
              ===========================*/
            initialize:function(){
                this.render();//使用backbone时，此行无用
            },
            render:function(){
                var self = this;
                this.validator={};
                //渲染页面
                this.form=new Form("#ID-Form",{
                    formFilterClass:"form-filter"
                });
                this.formContainer=this.form.container;
                this.formElements=this.form.formElements;
                this.btnSubmit=document.querySelector(".SID-BtnSubmit");

                this.prompt=new Prompt();
                this.formControls=new FormControls();;
                //加载数据
                this.loadData();
            },
            refresh:function(){
                console.log("刷新");
            },
            destroy:function(){
                console.log("移除");
            },
            loadData:function(){

                this._attach();//使用backbone时，此行无用
            },
            /*=========================
              Method
              ===========================*/
            _validateForm:function(){
                var validator=new Validator();
                validator.add(this.formContainer["NID-UserName"],[
                    {
                        rule:'required',
                        errorMsg:'用户名不能为空'
                    },{
                        rule:'minLength:6',
                        errorMsg:'用户名不能低于6位'
                    },{
                        rule:'username',
                        errorMsg:'用户名必须为字母数字或者下划线'
                    }
                ]);
                validator.add(this.formContainer["NID-Pwd"],[
                    {
                        rule:'required',
                        errorMsg:'密码不能为空'
                    },{
                        rule:'minLength:6',
                        errorMsg:'密码不能低于6位'
                    },{
                        rule:'maxLength:16',
                        errorMsg:'密码不能超过16位'
                    },{
                        rule:'password',
                        errorMsg:'密码格式不正确'
                    },{
                        rule:'safeLvl:3',
                        errorMsg:'密码强度不够'
                    }
                ]);
                validator.add(this.formContainer["NID-RePwd"],[
                    {
                        rule:'required',
                        errorMsg:'密码不能为空'
                    },{
                        rule:'minLength:6',
                        errorMsg:'密码不能低于6位'
                    },{
                        rule:'maxLength:16',
                        errorMsg:'密码不能超过16位'
                    },{
                        rule:'password',
                        errorMsg:'密码格式不正确'
                    },{
                        rule:'compare:'+this.formContainer["NID-Pwd"].value,
                        errorMsg:'两次密码输入不一致'
                    }
                ]);
                validator.add(this.formContainer["NID-Phone"],[
                    {
                        rule:'phone',
                        errorMsg:'手机号码不正确'
                    }
                ]);
                validator.add(this.formContainer["NID-Name"],[
                    {
                        rule:'chinese',
                        errorMsg:'姓名请输入中文'
                    }
                ]);
                validator.add(this.formContainer["NID-Mail"],[
                    {
                        rule:'mail',
                        errorMsg:'邮箱格式不正确'
                    }
                ]);
                validator.add(this.formContainer["NID-Age"],[
                    {
                        rule:'number',
                        errorMsg:'年龄只能为数字'
                    },{
                        rule:'minNumber:18',
                        errorMsg:'年龄最小18岁'
                    },{
                        rule:'maxNumber:48',
                        errorMsg:'年龄最大48岁'
                    }
                ]);
                var error=validator.start();
                return error;
            },
            _update:function(){
            },
            /*=========================
              Plugin
              ===========================*/
            /*=========================
              Events
              ===========================*/
            _attach:function(e){
                var self=this;
                this.formContainer.addEventListener("submit",this._onSubmit,false);
            },
            /*=========================
              Event Handler
              ===========================*/
            _onSubmit:function(e){
                //重置错误样式
                for(var i=0,el;el=view.formElements[i++];){
                    el.parentNode.classList.remove("app-error-active");
                }
                //表单验证
                var error=view._validateForm();
                if(error){
                    view.prompt.setText(error.errorMsg);
                    view.prompt.show();
                    error.field.parentNode.classList.add("app-error-active");
                    e.preventDefault();
                }
            }
        }

        window.addEventListener("load",function(){
            view.initialize();
        }, false);
        //定义exmobi返回
        function back(){history.go(-1);}
    </script>
</body>
</html>