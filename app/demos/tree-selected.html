<!doctype html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
	<title>tree-selected</title>
	<link rel="stylesheet" href="../scripts/lib/seedsui/seedsui.min.css">
</head>

<body ontouchstart="">
    <header>
        <div class="titlebar">
            <a class="titlebar-button titlebar-left" href="javascript:history.go(-1)">
                <i class="icon icon-arrowleft"></i>
            </a>
            <h1 class="titlebar-title text-center">人员选择</h1>
            <div class="titlebar-right">
                <a class="titlebar-button" id="ID-Tree-BtnClear">
                    <i class="icon icon-rdoclose"></i>
                </a>
                <a class="titlebar-button" id="ID-Tree-BtnSubmit">
                    <i class="icon icon-rdohook"></i>
                </a>
            </div>
        </div>
    </header>
    <article>
        <!-- tree bar -->
        <div class="tree-bar" id="ID-Tree-Bar"></div>
        <!-- tree -->
        <div class="tree-box" id="ID-Tree-Box">
            <ul class="tree" id="ID-Tree-List"></ul>
        </div>
    </article>
    <script src="../scripts/lib/seedsui/seedsui.min.js"></script>
    <script src="tree.data.js"></script>
	<script>
        var view={
            /*=========================
              Model
              ===========================*/
            render:function(){
                var self = this;

                //树结构
                this.tree=new Tree("#ID-Tree-List",{
                    data:data,
                    enableSelected:true,
                    bar:"#ID-Tree-Bar",
                    onData:function(option){
                        if(option.loginId){
                            var photo="";
                            if(option.avatarUrl){
                                photo='<span class="tree-photo" style="background-image:url('+option.avatarUrl+')"></span>';
                            }else{
                                photo='<span class="tree-photo" style="background-color:'+option.name.substr(0,1).toPinyin().substr(0,1).toColor()+'">'+option.name.substr(option.name.length-2,2)+'</span>';
                            }
                            option.html='<div class="tree-icon">'+photo+'</div>'+
                            '<div class="tree-title">'+option.name+'</div>';
                        }
                    },
                    onClick:function(e){
                        /*console.log("点击行："+e.targetLine);
                        console.log("点击元素："+e.target);
                        console.log("点击的li："+e.targetLi);*/
                    },
                    onClickLastChild:function(e){//没有子节点
                        console.log("没有子节点");
                        var id=e.targetLine.getAttribute("data-id");
                        if(id==="c6e56510-c293-48bc-ac8e-bfa3a1926417"){
                            console.log("立刻加载");
                            e.addData(userData,id,e.targetLine.nextElementSibling);
                        }
                    }
                });
                //加载数据
                this.loadData();
            },
            loadData:function(){
                this._attach();//使用backbone时，此行无用
            },
            /*=========================
              Model
              ===========================*/
            /*=========================
              Events
              ===========================*/
            _attach:function(e){
                var self=this;
                //点击清空按钮
                document.getElementById("ID-Tree-BtnClear").addEventListener("click",function(e){
                    self._onClickClear(e);
                },false);
                //点击确定按钮
                document.getElementById("ID-Tree-BtnSubmit").addEventListener("click",function(e){
                    self._onClickSubmit(e);
                },false);
            },
            /*=========================
              Event Handler
              ===========================*/
            _onClickSubmit:function(e){
                //获得值
                var selected=this.tree.selected,name="",id="";
                for(var n in selected){
                    id+=n+",";
                    name+=selected[n].getAttribute("data-name")+",";
                }
                name=name.substr(0,name.length-1);
                id=id.substr(0,id.length-1);
                console.log(name,id);
            },
            _onClickClear:function(e){
                this.tree.reset();
            }
        }

        window.addEventListener("load",function(){
            view.render();
        }, false);
	</script>
</body>
</html>
