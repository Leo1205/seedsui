<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="../images/favicon.ico">
    <link rel="apple-touch-icon-precomposed" href="../images/apple-touch-icon.png">
	<title>weixin</title>
	<link rel="stylesheet" href="../scripts/lib/seedsui/seedsui.min.css">
</head>

<body ontouchstart="">
		<header>
	        <div class="titlebar">
	            <a class="titlebar-button" href="javascript:back()">
	                <i class="icon icon-arrowleft"></i>
	            </a>
	            <h1 class="titlebar-title">微信本地能力</h1>
	        </div>
	    </header>
		<article id="weixin_demo_article" class="active">
			<ul class="list">
				<li class="statusbar underline" id="menu-basic">基础接口</li>
				<li class="li underline" id="checkJsApi">
					<div>
					<p>checkJsApi</p><small>判断当前客户端是否支持指定JS接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-share">分享接口</li>
				<li class="li underline" id="onMenuShareTimeline">
					<div>
					<p>onMenuShareTimeline</p><small>获取“分享到朋友圈”按钮点击状态及自定义分享内容接口</small>
					</div>
				</li>
				<li class="li underline" id="onMenuShareAppMessage">
					<div>
					<p>onMenuShareAppMessage</p><small>获取“分享给朋友”按钮点击状态及自定义分享内容接口</small>
					</div>
				</li>
				<li class="li underline" id="onMenuShareQQ">
					<div>
					<p>onMenuShareQQ</p><small>获取“分享到QQ”按钮点击状态及自定义分享内容接口</small>
					</div>
				</li>
				<li class="li underline" id="onMenuShareWeibo">
					<div>
					<p>onMenuShareWeibo</p><small>获取“分享到腾讯微博”按钮点击状态及自定义分享内容接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-image">图像接口</li>
				<li class="li underline" id="chooseImage">
					<div>
					<p>chooseImage</p><small>拍照或从手机相册中选图接口</small>
					</div>
				</li>
				<li class="li underline" id="previewImage">
					<div>
					<p>previewImage</p><small>预览图片接口</small>
					</div>
				</li>
				<li class="li underline" id="uploadImage">
					<div>
					<p>uploadImage</p><small>上传图片接口</small>
					</div>
				</li>
				<li class="li underline" id="downloadImage">
					<div>
					<p>downloadImage</p><small>下载图片接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-voice">音频接口</li>
				<li class="li underline" id="startRecord">
					<div>
					<p>startRecord</p><small>开始录音接口</small>
					</div>
				</li>
				<li class="li underline" id="stopRecord">
					<div>
					<p>stopRecord</p><small>停止录音接口</small>
					</div>
				</li>
				<li class="li underline" id="playVoice">
					<div>
					<p>playVoice</p><small>播放语音接口</small>
					</div>
				</li>
				<li class="li underline" id="pauseVoice">
					<div>
					<p>pauseVoice</p><small>暂停播放接口</small>
					</div>
				</li>
				<li class="li underline" id="stopVoice">
					<div>
					<p>stopVoice</p><small>停止播放接口</small>
					</div>
				</li>
				<li class="li underline" id="uploadVoice">
					<div>
					<p>uploadVoice</p><small>上传语音接口</small>
					</div>
				</li>
				<li class="li underline" id="downloadVoice">
					<div>
					<p>downloadVoice</p><small>下载语音接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-smart">智能接口</li>
				<li class="li underline" id="translateVoice">
					<div>
					<p>translateVoice</p><small>识别音频并返回识别结果接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-device">设备信息接口</li>
				<li class="li underline" id="getNetworkType">
					<div>
					<p>getNetworkType</p><small>获取网络状态接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-location">地理位置接口</li>
				<li class="li underline" id="openLocation">
					<div>
					<p>openLocation</p><small>使用微信内置地图查看位置接口</small>
					</div>
				</li>
				<li class="li underline" id="getLocation">
					<div>
					<p>getLocation</p><small>获取地理位置接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-webview">界面操作接口</li>
				<li class="li underline" id="hideOptionMenu">
					<div>
					<p>hideOptionMenu</p><small>隐藏右上角菜单接口</small>
					</div>
				</li>
				<li class="li underline" id="showOptionMenu">
					<div>
					<p>showOptionMenu</p><small>显示右上角菜单接口</small>
					</div>
				</li>
				<li class="li underline" id="closeWindow">
					<div>
					<p>closeWindow</p><small>关闭当前网页窗口接口</small>
					</div>
				</li>
				<li class="li underline" id="hideMenuItems">
					<div>
					<p>hideMenuItems</p><small>批量隐藏功能按钮接口</small>
					</div>
				</li>
				<li class="li underline" id="showMenuItems">
					<div>
					<p>showMenuItems</p><small>批量显示功能按钮接口</small>
					</div>
				</li>
				<li class="li underline" id="hideAllNonBaseMenuItem">
					<div>
					<p>hideAllNonBaseMenuItem</p><small>隐藏所有非基础按钮接口</small>
					</div>
				</li>
				<li class="li underline" id="showAllNonBaseMenuItem">
					<div>
					<p>showAllNonBaseMenuItem</p><small>显示所有功能按钮接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-scan">微信扫一扫</li>
				<li class="li underline" id="scanQRCode0">
					<div>
					<p>scanQRCode(微信处理结果)</p><small>调起微信扫一扫接口</small>
					</div>
				</li>
				<li class="li underline" id="scanQRCode1">
					<div>
					<p>scanQRCode(直接返回结果)</p><small>调起微信扫一扫接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-shopping">微信小店接口</li>
				<li class="li underline" id="openProductSpecificView">
					<div>
					<p>openProductSpecificView</p><small>跳转微信商品页接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-card">微信卡券接口</li>
				<li class="li underline" id="addCard">
					<div>
					<p>addCard</p><small>批量添加卡券接口</small>
					</div>
				</li>
				<li class="li underline" id="chooseCard">
					<div>
					<p>chooseCard</p><small>调起适用于门店的卡券列表并获取用户选择列表</small>
					</div>
				</li>
				<li class="li underline" id="openCard">
					<div>
					<p>openCard</p><small>查看微信卡包中的卡券接口</small>
					</div>
				</li>

				<li class="statusbar underline" id="menu-pay">微信支付接口</li>
				<li class="li underline" id="chooseWXPay">
					<div>
					<p>chooseWXPay</p><small>发起一个微信支付请求</small>
					</div>
				</li>
			</ul>
		</article>
	<script src="../scripts/lib/seedsui/seedsui.min.js"></script>
	<script src="../scripts/lib/weixin/sha.js"></script>
	<script src="../scripts/lib/weixin/weixin.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script>
	//定义exmobi返回
	function back(){history.go(-1);}

	//初始化微信接口
	var w=new Weixin();
	wx.ready(function(){
		alert("初始化接口完成");
	});
	wx.error(function(res){
		alert("调用接口失败："+res.errMsg);
	});
	//检测是否支持微信接口
	document.getElementById('checkJsApi').onclick=function() {
		wx.checkJsApi({
			jsApiList: ['checkJsApi', 'onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'translateVoice', 'startRecord', 'stopRecord', 'onVoiceRecordEnd', 'playVoice', 'pauseVoice', 'stopVoice', 'uploadVoice', 'downloadVoice', 'chooseImage', 'previewImage', 'uploadImage', 'downloadImage', 'getNetworkType', 'openLocation', 'getLocation', 'hideOptionMenu', 'showOptionMenu', 'closeWindow', 'scanQRCode', 'chooseWXPay', 'openProductSpecificView', 'addCard', 'chooseCard', 'openCard'],
			success: function(res) {
				alert(JSON.stringify(res));
			}
		});
	};

	// 2. 分享接口
	// 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
	document.getElementById('onMenuShareAppMessage').onclick= function() {
		wx.onMenuShareAppMessage({
			title: 'ExMobi+Agile Lite微信开发',
			desc: '原生UI组件UIXML引擎、HTML5引擎、原生插件引擎三大引擎并驾齐驱，跨平台多分辨率支持。',
			link: 'http://www.exmobi.cn/product.html',
			imgUrl: 'http://www.exmobi.cn/images/exmobi5.png',
			trigger: function(res) {
				// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
				alert('用户点击发送给朋友');
			},
			success: function(res) {
				alert('已分享');
			},
			cancel: function(res) {
				alert('已取消');
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
		alert('已注册获取“发送给朋友”状态事件');
	};

	// 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
	document.getElementById('onMenuShareTimeline').onclick= function() {
		wx.onMenuShareTimeline({
			title: 'ExMobi+Agile Lite微信开发',
			link: 'http://www.exmobi.cn/product.html',
			imgUrl: 'http://www.exmobi.cn/images/exmobi5.png',
			trigger: function(res) {
				// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
				alert('用户点击分享到朋友圈');
			},
			success: function(res) {
				alert('已分享');
			},
			cancel: function(res) {
				alert('已取消');
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
		alert('已注册获取“分享到朋友圈”状态事件');
	};

	// 2.3 监听“分享到QQ”按钮点击、自定义分享内容及分享结果接口
	document.getElementById('onMenuShareQQ').onclick= function() {
		wx.onMenuShareQQ({
			title: 'ExMobi+Agile Lite微信开发',
			desc: '原生UI组件UIXML引擎、HTML5引擎、原生插件引擎三大引擎并驾齐驱，跨平台多分辨率支持。',
			link: 'http://www.exmobi.cn/product.html',
			imgUrl: 'http://www.exmobi.cn/images/exmobi5.png',
			trigger: function(res) {
				alert('用户点击分享到QQ');
			},
			complete: function(res) {
				alert(JSON.stringify(res));
			},
			success: function(res) {
				alert('已分享');
			},
			cancel: function(res) {
				alert('已取消');
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
		alert('已注册获取“分享到 QQ”状态事件');
	};

	// 2.4 监听“分享到微博”按钮点击、自定义分享内容及分享结果接口
	document.getElementById('onMenuShareWeibo').onclick= function() {
		wx.onMenuShareWeibo({
			title: 'ExMobi+Agile Lite微信开发',
			desc: '原生UI组件UIXML引擎、HTML5引擎、原生插件引擎三大引擎并驾齐驱，跨平台多分辨率支持。',
			link: 'http://www.exmobi.cn/product.html',
			imgUrl: 'http://www.exmobi.cn/images/exmobi5.png',
			trigger: function(res) {
				alert('用户点击分享到微博');
			},
			complete: function(res) {
				alert(JSON.stringify(res));
			},
			success: function(res) {
				alert('已分享');
			},
			cancel: function(res) {
				alert('已取消');
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
		alert('已注册获取“分享到微博”状态事件');
	};

	// 3 智能接口
	var voice = {
		localId: '',
		serverId: ''
	};
	// 3.1 识别音频并返回识别结果
	document.getElementById('translateVoice').onclick= function() {
		if (voice.localId == '') {
			alert('请先使用 startRecord 接口录制一段声音');
			return;
		}
		wx.translateVoice({
			localId: voice.localId,
			complete: function(res) {
				if (res.hasOwnProperty('translateResult')) {
					alert('识别结果：' + res.translateResult);
				} else {
					alert('无法识别');
				}
			}
		});
	};

	// 4 音频接口
	// 4.2 开始录音
	document.getElementById('startRecord').onclick= function() {
		wx.startRecord({
			cancel: function() {
				alert('用户拒绝授权录音');
			}
		});
	};

	// 4.3 停止录音
	document.getElementById('stopRecord').onclick= function() {
		wx.stopRecord({
			success: function(res) {
				voice.localId = res.localId;
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
	};


	// 4.5 播放音频
	document.getElementById('playVoice').onclick= function() {
		if (voice.localId == '') {
			alert('请先使用 startRecord 接口录制一段声音');
			return;
		}
		wx.playVoice({
			localId: voice.localId
		});
	};

	// 4.6 暂停播放音频
	document.getElementById('pauseVoice').onclick= function() {
		wx.pauseVoice({
			localId: voice.localId
		});
	};

	// 4.7 停止播放音频
	document.getElementById('stopVoice').onclick= function() {
		wx.stopVoice({
			localId: voice.localId
		});
	};



	// 4.8 上传语音
	document.getElementById('uploadVoice').onclick= function() {
		if (voice.localId == '') {
			alert('请先使用 startRecord 接口录制一段声音');
			return;
		}
		wx.uploadVoice({
			localId: voice.localId,
			success: function(res) {
				alert('上传语音成功，serverId 为' + res.serverId);
				voice.serverId = res.serverId;
			}
		});
	};

	// 4.9 下载语音
	document.getElementById('downloadVoice').onclick= function() {
		if (voice.serverId == '') {
			alert('请先使用 uploadVoice 上传声音');
			return;
		}
		wx.downloadVoice({
			serverId: voice.serverId,
			success: function(res) {
				alert('下载语音成功，localId 为' + res.localId);
				voice.localId = res.localId;
			}
		});
	};

	// 5 图片接口
	// 5.1 拍照、本地选图
	var images = {
		localId: [],
		serverId: []
	};
	document.getElementById('chooseImage').onclick= function() {
		wx.chooseImage({
			success: function(res) {
				images.localId = res.localIds;
				alert('已选择 ' + res.localIds.length + ' 张图片');
			}
		});
	};

	// 5.2 图片预览
	document.getElementById('previewImage').onclick= function() {
		if (images.serverId.length == 0) {
			alert('请先使用 uploadImage 接口上传图片');
			return;
		}
		var serveridImageUrl = [];
		for (var key in images.serverId) {
			serveridImageUrl.push($config.weixinImageURI + '?serverid=' + images.serverId[key]);
		}
		wx.previewImage({
			current: $config.weixinImageURI + '?serverid=' + images.serverId[0],
			urls: serveridImageUrl
		});
	};

	// 5.3 上传图片
	document.getElementById('uploadImage').onclick= function() {
		if (images.localId.length == 0) {
			alert('请先使用 chooseImage 接口选择图片');
			return;
		}
		var i = 0,
			length = images.localId.length;
		images.serverId = [];

		function upload() {
			wx.uploadImage({
				localId: images.localId[i],
				success: function(res) {
					i++;
					alert('已上传：' + i + '/' + length);
					images.serverId.push(res.serverId);
					if (i < length) {
						upload();
					}
				},
				fail: function(res) {
					alert(JSON.stringify(res));
				}
			});
		}

		upload();
	};

	// 5.4 下载图片
	document.getElementById('downloadImage').onclick= function() {
		if (images.serverId.length === 0) {
			alert('请先使用 uploadImage 上传图片');
			return;
		}
		var i = 0,
			length = images.serverId.length;
		images.localId = [];

		function download() {
			wx.downloadImage({
				serverId: images.serverId[i],
				isShowProgressTips: 1,
				success: function(res) {
					i++;
					alert('已下载：' + i + '/' + length);
					images.localId.push(res.localId);
					if (i < length) {
						download();
					}
				}
			});
		}

		download();
	};

	// 6 设备信息接口
	// 6.1 获取当前网络状态
	document.getElementById('getNetworkType').onclick= function() {
		wx.getNetworkType({
			success: function(res) {
				alert(res.networkType);
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
	};

	// 7 地理位置接口
	// 7.1 查看地理位置
	document.getElementById('openLocation').onclick= function() {
		wx.openLocation({
			latitude: 31.990775,
			longitude: 118.737617,
			name: '南京烽火',
			address: '南京市云龙山路88号',
			scale: 14,
			infoUrl: 'http://www.exmobi.cn/'
		});
	};

	// 7.2 获取当前地理位置
	document.getElementById('getLocation').onclick= function() {
		wx.getLocation({
			success: function(res) {
				alert(JSON.stringify(res));
			},
			cancel: function(res) {
				alert('用户拒绝授权获取地理位置');
			}
		});
	};

	// 8 界面操作接口
	// 8.1 隐藏右上角菜单
	document.getElementById('hideOptionMenu').onclick= function() {
		wx.hideOptionMenu();
	};

	// 8.2 显示右上角菜单
	document.getElementById('showOptionMenu').onclick= function() {
		wx.showOptionMenu();
	};

	// 8.3 批量隐藏菜单项
	document.getElementById('hideMenuItems').onclick= function() {
		wx.hideMenuItems({
			menuList: ['menuItem:readMode', // 阅读模式
				'menuItem:share:timeline', // 分享到朋友圈
				'menuItem:copyUrl' // 复制链接
			],
			success: function(res) {
				alert('已隐藏“阅读模式”，“分享到朋友圈”，“复制链接”等按钮');
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
	};

	// 8.4 批量显示菜单项
	document.getElementById('showMenuItems').onclick= function() {
		wx.showMenuItems({
			menuList: ['menuItem:readMode', // 阅读模式
				'menuItem:share:timeline', // 分享到朋友圈
				'menuItem:copyUrl' // 复制链接
			],
			success: function(res) {
				alert('已显示“阅读模式”，“分享到朋友圈”，“复制链接”等按钮');
			},
			fail: function(res) {
				alert(JSON.stringify(res));
			}
		});
	};

	// 8.5 隐藏所有非基本菜单项
	document.getElementById('hideAllNonBaseMenuItem').onclick= function() {
		wx.hideAllNonBaseMenuItem({
			success: function() {
				alert('已隐藏所有非基本菜单项');
			}
		});
	};

	// 8.6 显示所有被隐藏的非基本菜单项
	document.getElementById('showAllNonBaseMenuItem').onclick= function() {
		wx.showAllNonBaseMenuItem({
			success: function() {
				alert('已显示所有非基本菜单项');
			}
		});
	};

	// 8.7 关闭当前窗口
	document.getElementById('closeWindow').onclick= function() {
		wx.closeWindow();
	};

	// 9 微信原生接口
	// 9.1.1 扫描二维码并返回结果
	document.getElementById('scanQRCode0').onclick= function() {
		wx.scanQRCode();
	};
	// 9.1.2 扫描二维码并返回结果
	document.getElementById('scanQRCode1').onclick= function() {
		wx.scanQRCode({
			needResult: 1,
			desc: 'scanQRCode desc',
			success: function(res) {
				alert(JSON.stringify(res));
			}
		});
	};

	// 10 微信支付接口
	// 10.1 发起一个支付请求
	document.getElementById('chooseWXPay').onclick= function() {
		window.open('https://open.weixin.qq.com/connect/oauth2/authorize?appid=' + wx.appId + '&redirect_uri=' + encodeURIComponent($config.weixinPayURI) + '&response_type=code&scope=snsapi_base&state=123456#wechat_redirect');
	};

	// 11.3  跳转微信商品页
	document.getElementById('openProductSpecificView').onclick= function() {
		wx.openProductSpecificView({
			productId: 'pDF3iY_m2M7EQ5EKKKWd95kAxfNw'
		});
	};

	// 12 微信卡券接口
	// 12.1 添加卡券
	document.getElementById('addCard').onclick= function() {
		wx.addCard({
			cardList: [{
				cardId: 'pDF3iY9tv9zCGCj4jTXFOo1DxHdo',
				cardExt: '{"code": "", "openid": "", "timestamp": "1418301401", "signature":"f54dae85e7807cc9525ccc127b4796e021f05b33"}'
			}, {
				cardId: 'pDF3iY9tv9zCGCj4jTXFOo1DxHdo',
				cardExt: '{"code": "", "openid": "", "timestamp": "1418301401", "signature":"f54dae85e7807cc9525ccc127b4796e021f05b33"}'
			}],
			success: function(res) {
				alert('已添加卡券：' + JSON.stringify(res.cardList));
			}
		});
	};

	// 12.2 选择卡券
	document.getElementById('chooseCard').onclick= function() {
		wx.chooseCard({
			cardSign: '97e9c5e58aab3bdf6fd6150e599d7e5806e5cb91',
			timestamp: 1417504553,
			nonceStr: 'k0hGdSXKZEj3Min5',
			success: function(res) {
				alert('已选择卡券：' + JSON.stringify(res.cardList));
			}
		});
	};

	// 12.3 查看卡券
	document.getElementById('openCard').onclick= function() {
		alert('您没有该公众号的卡券无法打开卡券。');
		wx.openCard({
			cardList: []
		});
	};



	if (wx.isWeixinFunction) {
		//分享配置
		var shareData={
			link:'http://raoh0822.imwork.net/workspace/measy/client/page/phone/default/www/local-share.html',
			title:'分享标题',
			desc:'分享内容分享内容分享内容',
			imgUrl:'http://exmobi.cn/2015/images/comm/logo.png',
		}
		
		wx.onMenuShareAppMessage(shareData);
		wx.onMenuShareTimeline(shareData);

		// 4.4 监听录音自动停止
		wx.onVoiceRecordEnd({
			complete: function(res) {
				voice.localId = res.localId;
				alert('录音时间已超过一分钟');
			}
		});

		// 4.8 监听录音播放停止
		wx.onVoicePlayEnd({
			complete: function(res) {
				alert('录音（' + res.localId + '）播放结束');
			}
		});
	}
	</script>
</body>
</html>
