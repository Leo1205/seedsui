<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="../images/favicon.ico">
    <link rel="apple-touch-icon-precomposed" href="../images/apple-touch-icon.png">
    <title>scrollpicker-datetime</title>
    <link rel="stylesheet" href="../scripts/lib/seedsui/seedsui.min.css">
    <style>
    .inputrow{
        position: relative;
        display: -webkit-box;
        -webkit-box-align: center;
        margin: 0 12px;
        overflow: hidden;
    }
    .inputrow .inputbox{
        -webkit-box-flex: 1;
    }
    .inputrow .inputbox>.icon{
        font-size: 20px;
        height: 20px;
        width: 20px;
        color: #20aeff;
    }
    .SID-DivDateTime .input-text, .SID-DivDateTime .icon {
        pointer-events: none;
    }
    </style>
</head>

<body ontouchstart="">
    <header>
        <div class="titlebar">
            <a class="titlebar-button" href="javascript:back()">
                <i class="icon icon-arrowleft"></i>
            </a>
            <h1 class="titlebar-title">日期选择器</h1>
        </div>
    </header>
    <article>
        <div class="group" id="ID-MeetAdd-GroupAdd">
            <div class="sliver underline">
                <span class="peg"></span>
                <p class="sliver-title">起止时间</p>
            </div>
            <div class="inputrow underline">
                <div class="inputbox SID-DivDateTime">
                    <i class="icon icon-time"></i>
                    <input type="text" class="input-text SID-DateTimeStart" readonly placeholder="开始时间">
                </div>
                <div class="inputbox leftline SID-DivDateTime">
                    <i class="icon icon-time" style="margin-left: 8px"></i>
                    <input type="text" class="input-text SID-DateTimeEnd" readonly placeholder="结束时间">
                </div>
            </div>
        </div>
    </article>
    <!--SeedsUI-->
    <script src="../scripts/lib/seedsui/seedsui.min.js"></script>
    <!--Exmobi能力-->
    <!--<script src="../scripts/lib/exmobi/exmobi.js"></script>-->
    <script type="text/javascript">
        var app={};
        app.prompt=new Prompt();
        var view={
            /*=========================
              Model
              ===========================*/
            render:function(){
                var self = this;
                //时间控件分钟数据
                this.minutesData=function(){
                    var data=[];
                    for(var i=0;i<60;i=i+10){
                        var temp=i<10?"0"+i:i;
                        data.push({key:temp,value:temp+"分"});
                    }
                    return data;
                }();
                //加载数据
                this.loadData();
            },
            refresh:function(){
                console.log("刷新");
            },
            destroy:function(){
                console.log("移除");
            },
            loadData:function(){

                this._attach();//使用backbone时，此行无用
            },
            /*=========================
              Method
              ===========================*/
            //时间控件
            _newSpDateTime:function(defaults,input){
                var self=this;
                this.spDateTime=new SpDate({
                    //parent:self.$el[0],
                    viewType:"datetime",
                    minutesData:self.minutesData,
                    isSimpleYear:true,
                    minYear:new Date().getFullYear()-5,
                    maxYear:new Date().getFullYear()+5,
                    yearClass:"text-center",
                    monthClass:"text-center",
                    dayClass:"text-center",
                    hourClass:"text-center",
                    minuteClass:"text-center",
                    isClickMaskHide:false,
                    onClickDone:function(e){
                        if(new Date(e.activeText)<=new Date()){
                            app.prompt.setText("时间不能早于当前时间");
                            app.prompt.show();
                            return;
                        }
                        if(input.classList.contains("SID-DateTimeStart")){//点击开始时间
                            var endInput=input.parentNode.nextElementSibling.querySelector(".SID-DateTimeEnd");
                            if(endInput.value==""){
                                var endTime=new Date(e.activeText).plusMinute(30);
                                endInput.value=endTime.format("yyyy-MM-dd hh:mm");
                            }else if(new Date(e.activeText) >= new Date(endInput.value)){
                                app.prompt.setText("开始时间不能晚于结束时间");
                                app.prompt.show();
                                return;
                            }
                        }else if(input.classList.contains("SID-DateTimeEnd")){//点击结束时间
                            var prevInput=input.parentNode.previousElementSibling.querySelector(".SID-DateTimeStart");
                            var startTime=new Date().setMinuteCeil(10);
                            if(new Date(e.activeText)<=startTime){
                                app.prompt.setText("结束时间太早啦~");
                                app.prompt.show();
                                return;
                            }
                            if(prevInput.value==""){
                                prevInput.value=startTime.format("yyyy-MM-dd hh:mm");
                            }else if(new Date(prevInput.value) >= new Date(e.activeText)){
                                app.prompt.setText("开始时间不能晚于结束时间");
                                app.prompt.show();
                                return;
                            }
                        }
                        input.value=e.activeText;
                        e.hide();
                    },
                    "onShowed":function(e){
                        e.setIsClickMaskHide(true);
                    },
                    "onHid":function(e){
                        e.destroy();
                    }
                });
                if(defaults && defaults.length>0){
                    this.spDateTime.setDefaultYear(defaults[0]);
                    this.spDateTime.setDefaultMonth(defaults[1]);
                    this.spDateTime.setDefaultDay(defaults[2]);
                    this.spDateTime.setDefaultHour(defaults[3]);
                    this.spDateTime.setDefaultMinute(defaults[4]);
                    this.spDateTime.update();
                }
            },
            /*=========================
              Events
              ===========================*/
            _attach:function(e){
                var self=this;
                //点击选择
                var dateTimeBoxes=document.querySelectorAll(".SID-DivDateTime");
                for(var i=0,div;div=dateTimeBoxes[i++];){
                    div.addEventListener("click",function(e){
                        self._onClickDivDateTime(e);
                    },false)
                }
            },
            /*=========================
              Event Handler
              ===========================*/
            //点击日期选择
            _onClickDivDateTime:function(e){
                var self=this;
                var defaults=[];
                var input=e.target.querySelector(".input-text");
                if(input.value!=""){
                    var split=input.value.split(" ");
                    var split1=split[0].split("-");
                    var split2=split[1].split(":");
                    defaults[0]=split1[0];
                    defaults[1]=split1[1];
                    defaults[2]=split1[2];
                    defaults[3]=split2[0];
                    defaults[4]=split2[1];
                }else{
                    var date=new Date().setMinuteCeil(10);
                    if(input.classList.contains("SID-DateTimeEnd")){
                        date.plusMinute(20);
                    }
                    defaults[0]=date.getFullYear();
                    defaults[1]=date.getMonth()+1;
                    defaults[2]=date.getDate();
                    defaults[3]=date.getHours();
                    defaults[4]=date.getMinutes();
                }
                this._newSpDateTime(defaults,input);
                setTimeout(function(){
                    self.spDateTime.show();
                },10);
            },
        }

        window.addEventListener("load",function(){
            view.render();
        }, false);

        //定义exmobi返回
        function back(){history.go(-1);}
    </script>
</body>
</html>
